(self.webpackChunkkingdomcomedeliverance2_item_database=self.webpackChunkkingdomcomedeliverance2_item_database||[]).push([[415],{340:()=>{},2594:e=>{"use strict";e.exports='<?xml version="1.0"?>\r\n<xsl:stylesheet version="1.0"\r\n  xmlns:xsl="http://www.w3.org/1999/XSL/Transform">\r\n\r\n  <xsl:output method="html" indent="yes"/>\r\n\r\n  <xsl:template match="/">\r\n    <div style="padding: 1em;">\r\n      <xsl:apply-templates/>\r\n    </div>\r\n  </xsl:template>\r\n\r\n  <xsl:template match="*">\r\n    <div class="xml-element" style="\r\n      font-family: Roboto, sans-serif;\r\n      background: #1e1e1e;\r\n      color: #e0e0e0;\r\n      border: 1px solid #333;\r\n      border-radius: 8px;\r\n      padding: 1em;\r\n      margin: 1em 0;\r\n      box-shadow: 0 2px 4px rgba(0,0,0,0.5);\r\n      min-width: 800px;\r\n      max-width: fit-content;\r\n      display: block;\r\n      width: fit-content;\r\n    ">\r\n\r\n      <div class="element-name" style="font-size: 1.2em;">\r\n        <span class="tag-name xml-copyable">\r\n          <xsl:attribute name="data-value">\r\n            <xsl:value-of select="name()"/>\r\n          </xsl:attribute>\r\n          <xsl:value-of select="name()"/>\r\n        </span>\r\n      </div>\r\n\r\n      \x3c!-- Attributes --\x3e\r\n      <xsl:if test="@*">\r\n        <table style="\r\n          width: 100%;\r\n          border-collapse: collapse;\r\n          margin-bottom: 0.5em;\r\n          table-layout: auto;\r\n          word-break: break-word;\r\n        ">\r\n          <xsl:for-each select="@*">\r\n              <tr class="attribute-row" style="border-bottom: 1px solid #444;">\r\n                <td style="padding: 0.25em 0.5em; font-weight: bold;">\r\n                  <span class="attr-name xml-copyable">\r\n                    <xsl:attribute name="data-value">\r\n                      <xsl:value-of select="name()"/>\r\n                    </xsl:attribute>\r\n                    <xsl:value-of select="name()"/>\r\n                  </span>\r\n                </td>\r\n                <td style="padding: 0.25em 0.5em; color: #bbb; word-break: break-word;">\r\n                  <span class="xml-copyable">\r\n                    <xsl:attribute name="data-value">\r\n                      <xsl:value-of select="."/>\r\n                    </xsl:attribute>\r\n                    <xsl:value-of select="."/>\r\n                  </span>\r\n                </td>\r\n              </tr>\r\n            </xsl:for-each>\r\n        </table>\r\n      </xsl:if>\r\n\r\n      \x3c!-- Child Elements --\x3e\r\n      <xsl:if test="*">\r\n        <div style="\r\n          margin-top: 0.5em;\r\n          padding-left: 1em;\r\n          border-left: 2px solid #444;\r\n        ">\r\n          <xsl:apply-templates select="*"/>\r\n        </div>\r\n      </xsl:if>\r\n\r\n    </div>\r\n  </xsl:template>\r\n\r\n</xsl:stylesheet>\r\n'},3372:e=>{"use strict";var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var i={},r=[],s=0;s<e.length;s++){var l=e[s],c=o.base?l[0]+o.base:l[0],d=i[c]||0,p="".concat(c," ").concat(d);i[c]=d+1;var m=n(p),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==m)t[m].references++,t[m].updater(u);else{var h=a(u,o);o.byIndex=s,t.splice(s,0,{identifier:p,updater:h,references:1})}r.push(p)}return r}function a(e,t){var n=t.domAPI(t);n.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,a){var i=o(e=e||[],a=a||{});return function(e){e=e||[];for(var r=0;r<i.length;r++){var s=n(i[r]);t[s].references--}for(var l=o(e,a),c=0;c<i.length;c++){var d=n(i[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}i=l}}},3419:e=>{"use strict";e.exports=function(e){return e[1]}},3991:e=>{"use strict";var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},5338:e=>{e.exports=function(e){function t(e){"undefined"!=typeof console&&(console.error||console.log)("[Script Loader]",e)}try{"undefined"!=typeof execScript&&"undefined"!=typeof attachEvent&&"undefined"==typeof addEventListener?execScript(e):"undefined"!=typeof eval?eval.call(null,e):t("EvalError: No eval function available")}catch(e){t(e)}}},5428:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},5439:(e,t,n)=>{"use strict";n.d(t,{T:()=>J});const o={flags:{enableItemStatistics:!0},randomIndexingMessages:["Indexing items, just for you","Downloading an absurdly large XML...","Preparing items...","Almost there, hang tight!","Crunching the latest data...","Loading every single item ID...","Did you know? You can use the @ symbol to filter item types, and !@ to exclude item types","Running unoptimized code","Consuming an absurdly large amount of memory"],searchBox:document.getElementById("searchBox"),results:document.getElementById("results"),detailPanel:document.getElementById("detailPanel"),itemInfo:document.getElementById("itemInfo"),viewsContainer:void 0,toggleXml:document.getElementById("toggleXml"),colorDemo:document.getElementById("colorDemo"),colorDemoSquare:document.getElementById("colorDemoSquare"),indexingProgress:document.getElementById("indexingProgress"),indexingProgressContainer:document.getElementById("indexingProgressContainer"),indexingPercent:document.getElementById("indexingPercent"),allTypes:[],typeColors:new Map,nameColors:new Map,items:[],xmlSizeInBytes:0,firstSearch:!0,randomRefreshTimer:void 0,randomItemsCount:0,detailPanelRandomTimer:void 0,openHomeButton:document.getElementById("openHomeButton"),homePage:document.getElementById("itemInfo")?.innerHTML,closeDetailPanelBtn:document.getElementById("closeDetailPanelBtn"),randomItemsContainer:document.getElementById("randomItemsContainer"),currentMainRandomUIDs:new Set,languages:{English:"English",French:"French",Spanish:"Espa√±ol",German:"Deutsch",Italian:"Italiano",Portuguese:"Portugu√™s",Russian:"–†—É—Å—Å–∫–∏–π",Korean:"ÌïúÍµ≠Ïñ¥",Chineset:"ÁπÅÈ´î‰∏≠Êñá",Chineses:"ÁÆÄ‰Ωì‰∏≠Êñá",Polish:"Polski",Czech:"ƒåe≈°tina",Turkish:"T√ºrk√ße",Ukrainian:"–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞",Japanese:"Êó•Êú¨Ë™û"},selectedLang:"English",localizedNames:{},languageSelect:document.getElementById("languageSelect"),selectedItemInDetailsPanel:void 0,clipboardIcon:'\n        <svg\n            width="16"\n            height="16"\n            viewBox="0 0 24 24"\n            fill="none"\n            stroke="currentColor"\n            stroke-width="2"\n        >\n            <path\n                d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"\n            ></path>\n            <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>\n        </svg>\n    ',fetchCache:{xslCache:new Map},statisticsContainer:document.getElementById("statisticsContainer")};class a{static _debug=!1;static data={};static setDebug(e,t){a._debug=e,t&&(window.State=a)}static get(e,t){const n=e in a.data?a.data[e]:o[e]??t;return a._debug&&console.log(`[STATE] GET ${e}: ${a.data[e]} (State) | ${o[e]} (Default) | Result: ${n}`),n}static set(e,t){a.data[e]=t,a._debug&&console.log(`[STATE] SET ${e}: ${t} (Set) | ${o[e]} (Default)`)}static has(e){return e in a.data}static delete(e){delete a.data[e]}static clear(){a.data={}}static all(){return{...a.data}}}const i=void 0!==crypto?.subtle;let r;async function s(){const e=await fetch("./api/get-key.php",{cache:"no-store"});if(!e.ok)throw new Error(`get-key failed: ${e.status}`);const{keyId:t,key:n}=await e.json();if(i){const e=Uint8Array.from(atob(n),e=>e.charCodeAt(0)),o=await crypto.subtle.importKey("raw",e,{name:"AES-GCM"},!1,["encrypt","decrypt"]);r={id:t,key:o,expires:Date.now()+33e5}}else{const e=CryptoJS.enc.Base64.parse(n);r={id:t,key:e,expires:Date.now()+33e5}}}async function l(e,t){if(i){const n=crypto.getRandomValues(new Uint8Array(12)),o=(new TextEncoder).encode(JSON.stringify(e)),a=await crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,o),i=new Uint8Array(a),r=i.slice(i.length-16),s=i.slice(0,i.length-16);return{iv:btoa(String.fromCharCode(...n)),ciphertext:btoa(String.fromCharCode(...s)),tag:btoa(String.fromCharCode(...r))}}{const n=CryptoJS.lib.WordArray.random(16),o=CryptoJS.AES.encrypt(JSON.stringify(e),t,{iv:n,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7});return{iv:CryptoJS.enc.Base64.stringify(n),ciphertext:o.ciphertext.toString(CryptoJS.enc.Base64),tag:""}}}async function c(e,t){if(i){const n=Uint8Array.from(atob(e.iv),e=>e.charCodeAt(0)),o=Uint8Array.from(atob(e.ciphertext),e=>e.charCodeAt(0)),a=Uint8Array.from(atob(e.tag),e=>e.charCodeAt(0)),i=new Uint8Array(o.length+a.length);i.set(o),i.set(a,o.length);const r=await crypto.subtle.decrypt({name:"AES-GCM",iv:n},t,i);return JSON.parse((new TextDecoder).decode(r))}{const n=CryptoJS.enc.Base64.parse(e.iv),o=CryptoJS.enc.Base64.parse(e.ciphertext),a=CryptoJS.AES.decrypt({ciphertext:o},t,{iv:n,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7});return JSON.parse(a.toString(CryptoJS.enc.Utf8))}}async function d(e,t,n){const o=e=>{if(n)return n(e);throw e};try{if(await async function(){(!r||Date.now()>=r.expires)&&await s()}(),!r)throw new Error("Invalid key cache");let n,a,i=await l(t,r.key),d=JSON.stringify({keyId:r.id,...i}),p=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:d});if(!p.ok&&(await s(),i=await l(t,r.key),d=JSON.stringify({keyId:r.id,...i}),p=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:d}),!p.ok))return o(new Error(`Proxy error: ${p.status}`));try{n=await p.json()}catch(e){return o(e)}try{a=await c(n,r.key)}catch{try{await s(),i=await l(t,r.key),d=JSON.stringify({keyId:r.id,...i});const n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:d});if(!n.ok)return o(new Error(`Proxy error after decrypt fail: ${n.status}`));a=await c(await n.json(),r.key)}catch(e){return o(e)}}if(a?.contentB64){const e=Uint8Array.from(atob(a.contentB64),e=>e.charCodeAt(0));a.blob=new Blob([e],{type:a.mimeType||"application/octet-stream"}),a.objectURL=URL.createObjectURL(a.blob)}return a}catch(e){return o(e)}}function p(e,t="#2196f3"){return[`%c${e}%c`,`background:${t};color:white;padding:2px 6px;border-radius:4px;font-weight:bold;`,""]}class m{}class u{static render(e,t,...n){const o=e.construct(...n);t.appendChild(o)}static renderHTML(e,...t){return e.construct(...t).outerHTML}}class h extends m{static stats;static container;static renderBtn;static progressEl;static progressWrap;static setData(e){a.get("flags").enableItemStatistics&&(h.stats=e,console.log(...p("UI","#1bc0da"),"Payload data set:",e))}static getContainer(){if(a.get("flags").enableItemStatistics)return h.container}static getRenderBtn(){if(a.get("flags").enableItemStatistics)return h.renderBtn}static renderCharts(){if(!h.stats)return!1;let e;h?.renderBtn&&(h.renderBtn.disabled=!0,h.renderBtn.textContent="Processing‚Ä¶"),h.progressWrap&&(h.progressWrap.style.display="block"),console.log(...p("UI","#1bc0da"),"Starting worker");try{e=new Worker(new URL(n.p+n.u(188),n.b))}catch(e){return console.error("Worker failed to start:",e),h.renderBtn&&(h.renderBtn.textContent="Render (worker failed)",h.renderBtn.disabled=!1),!1}return e.addEventListener("message",t=>{const n=t.data;if(!n||!n.type)return!1;if("progress"===n.type){const e=Number(n.progress)||0;h.progressEl&&(h.progressEl.style.width=`${e}%`)}else"done"===n.type&&n.payload&&(h.progressEl&&(h.progressEl.style.width="100%"),requestAnimationFrame(()=>{const t=document.getElementById("item-statistics-container");return t?!!n.payload&&(async function(e,t){if(!window.Highcharts)return;Highcharts.setOptions({credits:{enabled:!1}}),function(e,t){const n=document.createElement("div");n.style.marginBottom="10px";const o=document.createElement("select");o.style.padding="6px 10px",o.style.borderRadius="4px",o.style.backgroundColor="#2e2e2e",o.style.color="#f0f0f0",o.style.border="1px solid $444",o.style.fontSize="1rem",o.style.appearance="none";[{label:"Items per Source File",value:"filesPie"},{label:"Item Types",value:"typesPie"},{label:"Frequent Words in Names",value:"nameTreemap"},{label:"Frequent Words in Descriptions",value:"infoTreemap"},{label:"Type to Info Keyword Correlation",value:"heatmap"},{label:"Word Cloud: Names",value:"nameWordCloud"},{label:"Word Cloud: Descriptions",value:"infoWordCloud"}].forEach(e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,o.appendChild(t)}),n.appendChild(o),e.appendChild(n);const a=document.createElement("div");a.id="chart-view-container",e.appendChild(a);const i=()=>{a.innerHTML="";switch(o.value){case"filesPie":Highcharts.chart(a,{chart:{type:"pie",backgroundColor:"transparent"},title:{text:"Items per Source File"},series:[{name:"Items",colorByPoint:!0,data:t.filesPie}],plotOptions:{pie:{cursor:"pointer"}}});break;case"typesPie":Highcharts.chart(a,{chart:{type:"pie",backgroundColor:"transparent"},title:{text:"Item Types Distribution"},series:[{name:"Items",colorByPoint:!0,data:t.typesPie}],plotOptions:{pie:{cursor:"pointer"}}});break;case"nameTreemap":g(a,"Frequent Words in Item Names",t.nameTreemap);break;case"infoTreemap":g(a,"Frequent Words in Item Descriptions",t.infoTreemap);break;case"heatmap":{const{types:e,words:n,data:o}=t.heatmap;Highcharts.chart(a,{chart:{type:"heatmap",plotBorderWidth:1},title:{text:"Type to Info Keyword Correlation"},xAxis:{categories:n,labels:{rotation:-45}},yAxis:{categories:e,title:void 0},colorAxis:{min:0,minColor:"#FFFFFF",maxColor:Highcharts.getOptions().colors[0]},series:[{name:"Count",borderWidth:1,data:o}]});break}case"nameWordCloud":f(a,"Word Cloud: Names",t.nameTreemap);break;case"infoWordCloud":f(a,"Word Cloud: Descriptions",t.infoTreemap)}};o.addEventListener("change",i),i()}(e,t)}(t,n.payload).catch(e=>(console.error("Error rendering charts:",e),!1)),h.renderBtn&&(h.renderBtn.style.display="none"),h.progressWrap&&(h.progressWrap.style.display="none"),void(e&&e.terminate())):(console.warn("Chart container doesn't exist, exiting..."),!1)}))}),e.postMessage({cmd:"process",stats:h.stats,options:{topWords:250,topHeatmapWords:120,maxTypes:150}}),!0}construct(){if(h.container=document.createElement("div"),h.container.className="item-statistics",h.container.id="item-statistics-container",!window.Highcharts)return h.container;if(!a.get("flags").enableItemStatistics)return h.container;if(!h.stats)return h.container.textContent="No statistics available.",h.container;h.renderBtn=document.createElement("button"),h.renderBtn.id="renderChartBtn",h.renderBtn.textContent="Render Item Statistics",h.renderBtn.style.padding="10px 20px",h.renderBtn.style.marginBottom="8px",h.renderBtn.style.cursor="pointer",h.renderBtn.style.backgroundColor="#1e90ff",h.renderBtn.style.color="#fff",h.renderBtn.style.border="none",h.renderBtn.style.borderRadius="5px",h.renderBtn.style.fontSize="14px",h.container.appendChild(h.renderBtn);const e=document.createElement("div");e.style.display="none",e.style.marginTop="8px",e.style.marginBottom="8px",e.style.width="100%",e.style.background="#eee",e.style.borderRadius="6px",e.style.overflow="hidden";const t=document.createElement("div");return t.style.width="0%",t.style.height="8px",t.style.background="#3b82f6",e.appendChild(t),h.progressWrap=e,h.progressEl=t,h.container.appendChild(e),h.container}}function g(e,t,n){if(!window.Highcharts)return;const o=document.createElement("div");o.style.marginBottom="12px",e.appendChild(o);const a=document.createElement("div");a.textContent=t,a.style.marginBottom="6px",a.style.fontWeight="600",o.appendChild(a);const i=document.createElement("input");i.type="search",i.placeholder="Search disabled",i.disabled=!0,i.style.display="block",i.style.width="100%",i.style.marginBottom="8px",i.style.padding="6px 8px",i.style.borderRadius="6px",i.style.border="1px solid #ddd",o.appendChild(i);const r=document.createElement("div");r.style.width="100%",r.style.height="360px",o.appendChild(r);const s=n,l=Highcharts.chart(r,{series:[{type:"treemap",layoutAlgorithm:"squarified",allowTraversingTree:!0,levelIsConstant:!1,data:s,dataLabels:{enabled:!0,crop:!0,overflow:"justify"},cluster:{enabled:!0,pixelWidth:20,pixelHeight:20}}],title:{text:""},subtitle:{text:""}});let c;i.addEventListener("input",()=>{c&&clearTimeout(c),c=setTimeout(()=>{const e=(i.value||"").trim().toLowerCase();if(!e){const e=l.series[0];return e.setRootNode&&e.setRootNode(""),void l.series[0].points.forEach(e=>{e.setState("")})}const t=l.series[0].points.find(t=>t.name.toLowerCase().includes(e));if(t){const e=l.series[0];e.setRootNode&&e.setRootNode(t.id),t.setState("hover"),setTimeout(()=>t.setState(""),2e3)}},200)})}function f(e,t,n){window.Highcharts&&Highcharts.chart(e,{chart:{type:"wordcloud",backgroundColor:"transparent"},title:{text:t},series:[{type:"wordcloud",data:n.map(e=>({name:e.name,weight:e.value})),name:"Occurrences"}]})}function y(e){return e.toLowerCase().replace(/[^a-z0-9\s]/gi," ").split(/\s+/).filter(e=>e.length>2)}function b(){const e=document.getElementById("statisticsContainer");if(!e)return void console.warn(...p("UI","#1bc0da"),"No wrapper found when rendering statistics button");e.innerHTML=u.renderHTML(new h);const t=document.getElementById("renderChartBtn"),n=document.getElementById("item-statistics-container");n&&t?t.addEventListener("click",()=>{t.disabled=!0,t.textContent="Rendering...",requestIdleCallback(()=>{if(t){h.renderCharts()?t.textContent="Waiting for worker...":(t.disabled=!1,t.textContent="Rendering Error"),t.hidden=!0;const e=document.createElement("h3");e.textContent="Item Statistics";const o=document.createElement("p");o.textContent="Charts data generated from item data. Powered by Highcharts.",n.appendChild(e),n.appendChild(o),n.appendChild(document.createElement("br"))}})}):(n||console.warn(...p("UI","#1bc0da"),"No container found when rendering statistics button"),!t&&window.Highcharts&&console.warn(...p("UI","#1bc0da"),"No render button found when attaching event listener"))}function w(e,t){if(!t)return e;const n=new RegExp(`(${o=t,o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");var o;return e.replace(n,"<mark>$1</mark>")}class x extends m{construct(e,t){const n=document.createElement("div");return n.className="result-item",n.dataset.uid=e.uid.toString(),n.innerHTML=`\n\t\t\t<div class="type-tag" style="background: ${e.typeColor}">\n\t\t\t\t${w(e.type,t)}\n\t\t\t</div>\n\t\t\t<div class="item-name" style="color: ${e.nameColor}">\n\t\t\t\t${w(e.name,t)}\n\t\t\t</div>\n\t\t\t<div class="meta">\n\t\t\t\t<span>Item ID: ${w(e.id,t)}</span>\n\t\t\t\t<span>ID: ${w(e.rawName,t)}</span>\n\t\t\t</div>\n\t\t`,n}}function v(e,t){return u.renderHTML(new x,e,t)}function C(e,t,n="",o=void 0){const i=a.get("results");a.get("_clusterize")&&(a.get("_clusterize").destroy(!0),a.set("_clusterize",void 0)),i.innerHTML="";const r=document.createElement("div");r.className="progress-bar",r.style.width="0%",r.style.opacity="0",r.style.transition="width 0.2s ease, opacity 0.5s ease",i.appendChild(r);const s=document.createElement("table");s.style.width="100%",s.style.borderCollapse="collapse";const l=document.createElement("tbody");if(l.id="contentArea",s.appendChild(l),i.appendChild(s),i.style.position=i.style.position||"relative",i.style.overflowY=i.style.overflowY||"auto",!e.length)return void(l.innerHTML=`<tr><td class="no-results">No items found for "${t}"</td></tr>`);const c=e.map(e=>{const t=v(e,n);return t.trim().startsWith("<tr>")?t:`<tr><td>${t}</td></tr>`});o&&c.unshift(o),a.set("_clusterize",new window.Clusterize({rows:[],scrollId:void 0,contentId:"contentArea",no_data_text:"No results found",scrollElem:i,contentElem:l})),r.style.width="0%",r.style.opacity="1";let d=0;const p=c.length;const m=async()=>{const e=Math.min(d+200,p),t=c.slice(d,e);a.get("_clusterize").append(t),d=e;const n=Math.floor(d/p*100);r.style.width=`${n}%`,d<p?requestAnimationFrame(m):(r.style.width="100%",setTimeout(()=>{r.style.opacity="0"},200))};m()}function E(e){return Math.abs(1e6*Math.sin(e))%1}function S(e,t){const n=a.get("items").filter(e=>e.rawName!==e.name),o=[...n.length>=e?n:a.get("items")].map((e,n)=>({item:e,sortKey:E(t+n)})).sort((e,t)=>e.sortKey-t.sortKey).map(e=>e.item).slice(0,e);a.set("currentMainRandomUIDs",new Set(o.map(e=>e.uid)));C(o,"","",'\n            <tr class="random-header">\n                <td colspan="5">\n                    <p>What the community is searching:</p>\n                    <br>\n                </td>\n            </tr>\n        ')}function T(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return`${(e/1024**t).toFixed(2)} ${["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t]}`}function I(e){let t=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);return`hsl(${Math.abs(t%360)}, ${70+Math.abs(t%20)}%, ${60+Math.abs(t%15)}%)`}function k(e){let t=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);return`hsl(${Math.abs(t)%360}, 70%, 50%)`}function L(e){const t=e.innerHTML,n=I(e.dataset.value||"");e.innerHTML="Copied!";const o=e.style.backgroundColor,a=e.style.color;e.style.backgroundColor=n,e.classList.add("copied"),setTimeout(()=>{e.innerHTML=t,e.style.color="",e.classList.remove("copied"),e.style.backgroundColor=o,e.style.color=a},2e3)}const A=new Map;class B{static _instances=[];static _registeredSubclasses=[];rootElement;constructor(e){this.rootElement=e,B._instances.push(this)}cleanup(){this.rootElement.remove()}static get instances(){return B._instances}static clearAll(){B._instances.forEach(e=>{e.cleanup()}),B._instances.length=0}static get registeredSubclasses(){return B._registeredSubclasses}static registerSubclass(e,t){Array.isArray(t)||(t=[t]),B._registeredSubclasses.push({cls:e,types:t}),function(e,t){Array.isArray(e)||(e=[e]),e.forEach(e=>{A.has(e)||A.set(e,[]),A.get(e)?.push(t)})}(t,async(t,n)=>{const o=new e(n);await o.render(t)})}}B.registerSubclass(class extends B{async render(e){const t=document.createElement("pre");t.id="fullXml",t.style.whiteSpace="pre-wrap",t.dataset.rawXml=e.xml,a.set("fullXml",t),this.rootElement.appendChild(t);try{const n=await async function(e,t){let n="";if(a.get("fetchCache").xslCache.get(t))n=a.get("fetchCache").xslCache.get(t);else{const e=await fetch(t);n=await e.text(),a.get("fetchCache").xslCache.set(t,n)}const o=(new DOMParser).parseFromString(n,"application/xml"),i=(new DOMParser).parseFromString(e,"application/xml"),r=new XSLTProcessor;return r.importStylesheet(o),r.transformToFragment(i,document)}(e.xml,"item-style.xsl");t.innerHTML="",t.appendChild(n)}catch(n){console.error("XSLT processing failed:",n),t.textContent=e.xml}}},"*");const M=[{test:e=>e.endsWith("github.io"),name:"github-pages"}];function D(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}B.registerSubclass(class extends B{static matchesItem(e){try{const t=(new DOMParser).parseFromString(e.xml,"application/xml").documentElement;return"Document"===t.tagName&&!!t.querySelector("DocumentContent")}catch{return!1}}async render(e){const t=(new DOMParser).parseFromString(e.xml,"application/xml").querySelector("DocumentContent");if(!t)return;const n=(t.getAttribute("Parts")||"").split(/\s+/).filter(Boolean),o=`Localization/${a.get("selectedLang")||"English"}_xml/text_ui_items.xml`,i=await d("./api/proxy.php",{action:"fetch",resource:o},e=>{});if(!i||!1===i.ok)throw new Error(`Failed to load ${o}`);const r=(new DOMParser).parseFromString(i.content??"","application/xml"),s=Array.from(r.querySelectorAll("Row")),l=new Map;for(const e of s){const t=Array.from(e.querySelectorAll("Cell")),n=t[0]?.textContent?.trim(),o=t[2]?.innerHTML?.trim(),a=t[1]?.innerHTML?.trim(),i=o||a;n&&i&&l.set(n,i)}this.rootElement.innerHTML="";const c=this.rootElement.attachShadow({mode:"open"}),p=document.createElement("style");p.textContent='\n            :host {\n                --bg: #0a0c14; /* slightly darker than before */\n                --panel: #121622;\n                --panel-2: #161b2e; /* subtle gradient difference */\n                --text: #e4e7f1; /* slightly softer white */\n                --muted: #8f98ac; /* softer muted text */\n                --accent: #4f91ff; /* less neon, more subdued blue */\n                --accent-2: #9c7aff; /* nicer gradient accent */\n                --border: #1f2435; /* softer border for dark mode */\n                --card-radius: 16px;\n                --shadow: 0 8px 24px rgba(0, 0, 0, 0.45); /* slightly softer shadow */\n                --shadow-soft: 0 6px 18px rgba(0, 0, 0, 0.3);\n                --page-bg: #10141f; /* dark page background */\n                --page-text: #e4e7f1; /* readable text on dark page */\n                color: var(--text);\n                font:\n                    500 15px/1.6 system-ui,\n                    Segoe UI,\n                    Roboto,\n                    Inter,\n                    "Helvetica Neue",\n                    Arial,\n                    sans-serif;\n                letter-spacing: 0.2px;\n                display: block;\n            }\n\n            @media (prefers-color-scheme: light) {\n                :host {\n                    --bg: #f6f7fb;\n                    --panel: #ffffff;\n                    --panel-2: #ffffff;\n                    --text: #0f1320;\n                    --muted: #5f6780;\n                    --accent: #2458ff;\n                    --accent-2: #7a35ff;\n                    --border: #e9edf5;\n                    --shadow: 0 10px 30px rgba(30, 50, 90, 0.08);\n                    --shadow-soft: 0 6px 20px rgba(30, 50, 90, 0.06);\n                    --page-bg: #ffffff;\n                    --page-text: #0f1320;\n                }\n            }\n\n            .container {\n                background: var(--bg);\n                border-radius: var(--card-radius);\n                padding: 18px;\n            }\n\n            .header {\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                margin-bottom: 14px;\n            }\n\n            .titlebar {\n                display: flex;\n                gap: 10px;\n                align-items: center;\n            }\n\n            .badge {\n                font-size: 12px;\n                padding: 4px 10px;\n                border-radius: 999px;\n                background: linear-gradient(\n                    135deg,\n                    color-mix(in oklab, var(--accent) 70%, transparent),\n                    color-mix(in oklab, var(--accent-2) 70%, transparent)\n                );\n                color: white;\n                letter-spacing: 0.3px;\n            }\n\n            .counter {\n                font-size: 12px;\n                color: var(--muted);\n            }\n\n            .toolbar {\n                display: flex;\n                gap: 8px;\n            }\n\n            .btn {\n                appearance: none;\n                border: 1px solid var(--border);\n                background: linear-gradient(180deg, var(--panel), var(--panel-2));\n                color: var(--text);\n                padding: 8px 12px;\n                border-radius: 12px;\n                cursor: pointer;\n                box-shadow: var(--shadow-soft);\n                transition:\n                    transform 0.12s ease,\n                    box-shadow 0.2s ease,\n                    opacity 0.2s ease;\n                display: inline-flex;\n                align-items: center;\n                gap: 8px;\n                font-weight: 600;\n            }\n            .btn:hover {\n                transform: translateY(-1px);\n                box-shadow: var(--shadow);\n            }\n            .btn:disabled {\n                opacity: 0.45;\n                cursor: not-allowed;\n                transform: none;\n            }\n\n            .document {\n                display: grid;\n                gap: 16px;\n            }\n\n            .page {\n                background: var(--page-bg);\n                color: var(--page-text);\n                border-radius: 18px;\n                box-shadow: var(--shadow);\n                border: 1px solid var(--border);\n                min-height: 560px;\n                padding: 28px 28px 40px;\n                box-sizing: border-box;\n            }\n\n            .page :where(p, .paragraph) {\n                margin: 0.6em 0;\n            }\n            .page .poem,\n            .page .lpoem {\n                font-style: italic;\n                margin: 0.6em 0;\n                white-space: pre-wrap;\n            }\n            .page .heading {\n                font-weight: 800;\n                font-size: 1.6rem;\n                letter-spacing: 0.2px;\n                margin: 1.2em 0 0.6em;\n            }\n            .page .title {\n                font-weight: 900;\n                font-size: 2rem;\n                text-align: center;\n                margin: 0.4em 0;\n            }\n            .page .subtitle {\n                font-weight: 800;\n                font-size: 1.3rem;\n                text-align: center;\n                margin: 0.2em 0 0.8em;\n                color: #7b8191; /* muted but visible on dark background */\n            }\n\n            .page img {\n                max-width: 100%;\n                height: auto;\n                display: block;\n                margin: 0.6em auto;\n                border-radius: 8px;\n                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); /* softer image shadow */\n            }\n\n            .part-sep {\n                height: 1px;\n                background: linear-gradient(\n                    90deg,\n                    transparent,\n                    color-mix(in oklab, var(--accent) 40%, transparent),\n                    transparent\n                );\n                margin: 14px 0;\n                border: 0;\n            }\n\n            .nav {\n                display: flex;\n                gap: 8px;\n                align-items: center;\n                justify-content: center;\n                margin-top: 8px;\n            }\n\n            kbd {\n                font-family:\n                    ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono",\n                    monospace;\n                background: #eceff7;\n                color: #1f2433;\n                border-radius: 6px;\n                padding: 2px 6px;\n                border: 1px solid #dbe1f0;\n                font-size: 12px;\n            }\n            @media (prefers-color-scheme: dark) {\n                kbd {\n                    background: #1e2438;\n                    color: #eef3ff;\n                    border-color: #2f3a57;\n                }\n            }\n        ',c.appendChild(p);const m=document.createElement("div");m.className="container",c.appendChild(m);const u=document.createElement("div");u.className="header";const h=document.createElement("div");h.className="titlebar";const g=document.createElement("div");g.className="badge",g.textContent="Document Viewer";const f=document.createElement("div");f.className="counter",f.textContent="Page 1 / 1",h.appendChild(g),h.appendChild(f);const y=document.createElement("div");y.className="toolbar";const b=document.createElement("button");b.className="btn",b.textContent="‚óÄ Prev";const w=document.createElement("button");w.className="btn",w.textContent="Next ‚ñ∂";const x=document.createElement("button");x.className="btn",x.textContent="üß† Summarize","github-pages"===function(e){const t=e??("undefined"!=typeof window?window.location.hostname:"");for(const e of M)if(e.test(t))return e.name;return"live"}()&&(x.disabled=!0),x.onclick=async()=>{x.disabled=!0,x.textContent="Summarizing...";try{const e=function(e){const t=document.createElement("div");function n(e){if(e.nodeType===Node.TEXT_NODE)return e.textContent||"";if(e.nodeType===Node.ELEMENT_NODE){const t=e,o=t.tagName.toUpperCase();return`[${o}]${Array.from(t.childNodes).map(n).join("")}[/${o}]`}return""}t.innerHTML=e;return D(Array.from(t.childNodes).map(n).join("\n"))}(I.flat().map(e=>{const t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML}).join("\n\n")),t=await fetch("./api/ai/summarize.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})});if(!t.ok)throw new Error("Summarization request failed");const n=(await t.json()).summary??"No summary returned",o=document.createElement("div");o.style.position="fixed",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.height="100%",o.style.display="flex",o.style.justifyContent="center",o.style.alignItems="center",o.style.backdropFilter="blur(6px)",o.style.background="rgba(0,0,0,0.5)",o.style.opacity="0",o.style.transition="opacity 0.25s ease",o.style.zIndex="9999",requestAnimationFrame(()=>{o.style.opacity="1"});const a=document.createElement("div");a.style.background="rgba(18,22,34,0.95)",a.style.color="var(--page-text)",a.style.padding="28px",a.style.borderRadius="16px",a.style.maxWidth="700px",a.style.width="90%",a.style.maxHeight="80%",a.style.overflowY="auto",a.style.boxShadow="0 12px 40px rgba(0,0,0,0.6)",a.style.backdropFilter="blur(6px)",a.style.position="relative",a.style.display="flex",a.style.flexDirection="column",a.style.gap="16px",a.style.transition="transform 0.25s ease",a.style.transform="translateY(-20px)";const i=document.createElement("pre");i.style.whiteSpace="pre-wrap",i.style.wordBreak="break-word",i.style.margin="0",i.style.display="block",i.style.fontFamily="sans-serif",i.innerHTML="",i.innerHTML=function(e){const t="<|end|>",n=e.split(t);return n.length<2?"":n[n.length-2].trim()}(n),a.appendChild(i);const r=document.createElement("button");r.textContent="‚úñ Close",r.className="btn",r.style.alignSelf="flex-end",r.onclick=()=>{o.style.opacity="0",a.style.transform="translateY(-20px)",setTimeout(()=>o.remove(),250)},a.appendChild(r),o.appendChild(a),c.appendChild(o)}catch(e){console.error(e),alert(`Error summarizing document: ${e.message}`)}finally{x.disabled=!1,x.textContent="üß† Summarize"}},y.appendChild(x),y.appendChild(b),y.appendChild(w),u.appendChild(h),u.appendChild(y),m.appendChild(u);const v=document.createElement("div");v.className="document",m.appendChild(v);const C=document.createElement("div");C.className="page",v.appendChild(C);const E=new Map,S=[];t.querySelectorAll("Image").forEach(e=>{const t=parseInt(e.getAttribute("Page")||"0",10),n=e.getAttribute("Image");if(!Number.isNaN(t)&&n){const e=document.createElement("div");e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center",e.style.height="100%";const o=document.createElement("img");o.setAttribute("src",n),o.loading="lazy",o.dataset.isMapPage="true",e.appendChild(o),E.has(t)||E.set(t,[]),E.get(t)?.push(e),S.push(e)}}),S.forEach(e=>{this.fetchImages(e).catch(e=>{console.error("Image failed to load",e)})});const T=document.createDocumentFragment();for(let e=0;e<n.length;e++){const t=n[e],o=l.get(t);if(!o)continue;const a=document.createElement("div");for(a.innerHTML=D(o),this.replaceCustomTagsExtended(a),await this.fetchImages(a);a.firstChild;)T.appendChild(a.firstChild);if(e<n.length-1){const e=document.createElement("hr");e.className="part-sep",T.appendChild(e)}}const I=[],k=[...E.entries()].sort((e,t)=>e[0]-t[0]);for(const[e,t]of k)I[e]=[],t.forEach(t=>{I[e].push(t)});let L=[];if(T.childNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE&&"newpage"===e.tagName.toLowerCase()){if(L.length){const e=I.findIndex(e=>!e);-1!==e?I[e]=L:I.push(L),L=[]}}else L.push(e)}),L.length){const e=I.findIndex(e=>!e);-1!==e?I[e]=L:I.push(L)}0===I.length&&I.push([]);let A=0;const B=e=>{if(C.innerHTML="",e<0||e>=I.length)return;const t=document.createDocumentFragment();I[e].forEach(e=>{t.appendChild(e)}),C.appendChild(t),f.textContent=`Page ${e+1} / ${I.length}`,b.disabled=0===e,w.disabled=e===I.length-1};b.onclick=()=>{A>0&&(A-=1,B(A))},w.onclick=()=>{A<I.length-1&&(A+=1,B(A))},this.rootElement.addEventListener("keydown",e=>{"ArrowLeft"===e.key&&b.click(),"ArrowRight"===e.key&&w.click()}),this.rootElement.tabIndex=0,B(A)}replaceCustomTagsExtended(e){Object.entries({poem:"div.poem",lpoem:"div.lpoem",paragraph:"div.paragraph",accent:"span.accent",heading:"div.heading",title:"div.title",subtitle:"div.subtitle",strong:"strong",p:"p"}).forEach(([t,n])=>{e.querySelectorAll(t).forEach(e=>{const[t,o]=n.split("."),a=document.createElement(t);for(o&&(a.className=o);e.firstChild;)a.appendChild(e.firstChild);const i=e.getAttribute("align");i&&(a.style.textAlign=i),e.replaceWith(a)})}),e.querySelectorAll("font").forEach(e=>{const t=e.getAttribute("size"),n=document.createElement("span");for(;e.firstChild;)n.appendChild(e.firstChild);t&&(n.style.fontSize=/^\d+$/.test(t)?`${t}px`:t),e.replaceWith(n)}),e.querySelectorAll("p[align]").forEach(e=>{const t=e.getAttribute("align");t&&(e.style.textAlign=t)}),e.querySelectorAll("img").forEach(e=>{const t=e,n=t.getAttribute("width"),o=t.getAttribute("height");n&&/^\d+$/.test(n)&&(t.width=parseInt(n,10)),o&&/^\d+$/.test(o)&&(t.height=parseInt(o,10));const a=t.getAttribute("align")?.toLowerCase();t.style.display="block",t.style.margin="0.6em auto",t.style.float="none","left"===a?(t.style.margin="0.6em 1em 0.6em 0",t.style.float="left"):"right"===a?(t.style.margin="0.6em 0 0.6em 1em",t.style.float="right"):"center"===a&&(t.style.marginLeft="auto",t.style.marginRight="auto")})}async fetchImages(e,t=["IPL_GameData/Libs/UI/Textures/Books/out/Unique","IPL_GameData/Libs/UI/Textures/Books/out/Maps","IPL_GameData/Libs/UI/Textures/Books/out/Skills","IPL_GameData/Libs/UI/Textures/Books/out/Recipes","IPL_GameData/Libs/UI/Textures/Books/out/Ingredients","IPL_GameData/Libs/UI/Textures/Books/out/Herbs","IPL_GameData/Libs/UI/Textures/Books/out/Decorations"]){const n=Array.from(e.querySelectorAll("img"));await Promise.all(n.map(async e=>{const n=e,o=n.getAttribute("src");if(!o)return;n.removeAttribute("src");let a=!1;for(const e of t){const t=`${e}/${o}_ui.png`;try{const e=await d("./api/proxy.php",{action:"fetch",resource:t});let o;if(e?.blob instanceof Blob)o=e.blob;else if(e?.contentB64){const t=Uint8Array.from(atob(e.contentB64),e=>e.charCodeAt(0));o=new Blob([t],{type:e.mimeType||"application/octet-stream"})}else e?.content&&(o=new Blob([e.content],{type:e.mimeType||"text/plain"}));if(o){n.src=URL.createObjectURL(o),a=!0;break}}catch{}}a||console.warn("Failed to load image from all fallback paths:",o)}))}},"Document");class P{static listeners=new Map;static add(e,t,n,o={}){P.listeners.has(e)||P.listeners.set(e,new Map);const a=P.listeners.get(e);if(!a)return;a.has(t)||(a.set(t,new Map),e.addEventListener(t,e=>{const n=a.get(t);if(n)for(const t of n.values())t(e)},o.domOptions));const i=a.get(t);if(!i)return;for(const e of i.values())e(event);const r=o.id??n.toString();i.has(r)&&!o.overwrite||i.set(r,n)}static remove(e,t,n){const o=P.listeners.get(e);if(!o)return;const a=o.get(t);if(a)if("string"==typeof n)a.delete(n);else for(const[e,t]of a.entries())if(t===n){a.delete(e);break}}}async function $(e){a.set("selectedItemInDetailsPanel",e.uid);const t=k(e.type),n=k(e.name),o=a.get("localizedNames")[e.rawUIName]||e.name;a.get("itemInfo").innerHTML=`\n    <div class="item-header">\n      <span class="type-badge force-copyable" data-value="${e.type}" style="background: ${t}">${e.type}</span>\n      <h3 style="color: ${n}" class="copyable" data-value="${o}">${o}</h3>\n      <small class="item-name-id copyable" data-value="${e.rawName}">(${e.rawName})</small>\n    </div>\n    <div class="details-grid">\n      <div class="detail-row">\n        <span class="detail-label">ID:</span>\n        <span class="detail-value copyable" data-value="${e.id}">${e.id}<span class="copy-icon">${a.get("clipboardIcon")}</span></span>\n      </div>\n      <div class="detail-row">\n        <span class="detail-label">Type:</span>\n        <span class="detail-value copyable" data-value="${e.type}">${e.type}<span class="copy-icon">${a.get("clipboardIcon")}</span></span>\n      </div>\n      <div class="detail-row">\n        <span class="detail-label">Description:</span>\n        <span class="detail-value copyable" data-value="${e.info}">${e.info}<span class="copy-icon">${a.get("clipboardIcon")}</span></span>\n      </div>\n    </div>\n  `;let i=a.get("detailPanel").querySelector(".custom-views-container");i||(i=document.createElement("div"),i.className="custom-views-container",a.set("viewsContainer",i),a.get("detailPanel").appendChild(i)),i.innerHTML="",i.hidden=!1,B.clearAll();const r=(s=e.type,[...A.get(s)||[],...A.get("*")||[]]);var s;for(const t of r)try{const n=document.createElement("div");n.className="detail-view",i.appendChild(n),await t(e,n)}catch(e){console.error("Detail panel view error:",e)}document.querySelectorAll(".copyable").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.dataset.value;n&&navigator.clipboard.writeText(n).then(()=>{L(e)})})}),document.querySelectorAll(".force-copyable").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.dataset.value;n&&navigator.clipboard.writeText(n).then(()=>{L(e)})})}),document.querySelectorAll(".xml-copyable").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.dataset.copyValue||e.textContent?.trim();n&&navigator.clipboard.writeText(n).then(()=>{L(e)})})}),a.get("viewsContainer")&&a.get("viewsContainer").addEventListener("copy",e=>{const t=window.getSelection();t&&!t.isCollapsed&&(e.clipboardData.setData("text/plain",t.toString()),e.preventDefault())})}function N(e,t){if(a.set("lastRandomRefresh",Date.now()),!function(){const e=!a.get("itemInfo").innerText.trim(),t=a.get("viewsContainer")?.hidden||!a.get("viewsContainer")?.innerText.trim();return e&&t}())return;const n=a.get("items").filter(e=>e.rawName!==e.name&&!a.get("currentMainRandomUIDs").has(e.uid)),o=[...n.length>=e?n:a.get("items").filter(e=>!a.get("currentMainRandomUIDs").has(e.uid)&&e.rawName!==e.name)].map((e,n)=>({item:e,sortKey:E(t+n)})).sort((e,t)=>e.sortKey-t.sortKey).map(e=>e.item).slice(a.get("randomItemsCount"),e+a.get("randomItemsCount"));a.get("randomItemsContainer").innerHTML=`\n            <div class="random-header"><p>Suggestions based on your previous searches:</p><br></div>\n            ${o.map(e=>v(e,"")).join("")}\n        `,a.get("detailPanel").style.display="block"}B.registerSubclass(class extends B{tooltipDiv=void 0;tooltipVisible=!1;mouseX=0;mouseY=0;currentX=0;currentY=0;animationFrame=0;hasPositionBeenSet=!1;initTooltip(){if(this.tooltipDiv)return;this.tooltipDiv=document.createElement("div"),Object.assign(this.tooltipDiv.style,{position:"fixed",pointerEvents:"none",backgroundColor:"var(--surface)",color:"var(--text)",border:"1px solid var(--border)",borderRadius:"4px",padding:"6px 10px",fontSize:"0.85em",maxWidth:"280px",boxShadow:"0 0 8px rgba(0,0,0,0.6)",opacity:"0",transition:"opacity 0.15s ease",zIndex:"9999",left:"0px",top:"0px",whiteSpace:"normal",lineHeight:"1.2em"}),document.body.appendChild(this.tooltipDiv);let e=performance.now();const t=n=>{if(!this.tooltipVisible)return this.hasPositionBeenSet=!1,requestAnimationFrame(t),void(e=n);const o=(n-e)/1e3;if(e=n,this.hasPositionBeenSet){const e=12,t=1-Math.exp(-e*o);this.currentX+=(this.mouseX+12-this.currentX)*t,this.currentY+=(this.mouseY+20-this.currentY)*t}else this.currentX=this.mouseX+12,this.currentY=this.mouseY+20,this.hasPositionBeenSet=!0;this.tooltipDiv&&(this.tooltipDiv.style.left=`${this.currentX}px`,this.tooltipDiv.style.top=`${this.currentY}px`),requestAnimationFrame(t)};requestAnimationFrame(t),window.addEventListener("scroll",()=>{requestAnimationFrame(t)}),window.addEventListener("resize",()=>{requestAnimationFrame(t)})}showTooltip(e){this.tooltipDiv||this.initTooltip(),this.tooltipDiv&&(this.tooltipDiv.textContent=e,this.tooltipDiv.style.opacity="1"),this.tooltipVisible=!0}hideTooltip(){this.tooltipDiv&&(this.tooltipDiv.style.opacity="0",this.tooltipVisible=!1)}attachTooltipListeners(e){e.addEventListener("mouseover",t=>{const n=e.dataset.tooltip;n&&(this.mouseX=t.clientX,this.mouseY=t.clientY,this.showTooltip(n))}),e.addEventListener("mousemove",e=>{this.mouseX=e.clientX,this.mouseY=e.clientY}),e.addEventListener("mouseout",e=>{const t=e.relatedTarget;t?.dataset.tooltip||this.hideTooltip()}),P.add(window,"scroll",()=>{this.mouseX=this.mouseX,this.mouseY=this.mouseY,this.hasPositionBeenSet=!1;this.currentX=this.mouseX+12,this.currentY=this.mouseY+20,requestAnimationFrame(()=>{this.tooltipDiv&&(this.tooltipDiv.style.left=`${this.currentX}px`,this.tooltipDiv.style.top=`${this.currentY}px`)})},{id:"sideWeightsViewScrollHandler_tooltip",overwrite:!0,domOptions:{passive:!0}}),P.add(window,"resize",()=>{this.mouseX=this.mouseX,this.mouseY=this.mouseY,this.hasPositionBeenSet=!1;this.currentX=this.mouseX+12,this.currentY=this.mouseY+20,requestAnimationFrame(()=>{this.tooltipDiv&&(this.tooltipDiv.style.left=`${this.currentX}px`,this.tooltipDiv.style.top=`${this.currentY}px`)})},{id:"sideWeightsViewResizeHandler_tooltip",overwrite:!0,domOptions:{passive:!0}})}currentHoveredEl=null;attachHoverListeners(e){const t=e.style.backgroundColor,n=()=>{this.currentHoveredEl&&(this.currentHoveredEl.style.backgroundColor=t||"",this.currentHoveredEl=null)};e.addEventListener("mouseover",()=>{e.style.backgroundColor="#007bff1a",this.currentHoveredEl=e}),e.addEventListener("mouseleave",n),P.add(window,"scroll",n,{id:"sideWeightsViewResizeHandler_hover_globalHoverClearScroll",overwrite:!0,domOptions:{passive:!0}}),P.add(window,"resize",n,{id:"sideWeightsViewResizeHandler_hover_globalHoverClearResize",overwrite:!0,domOptions:{passive:!0}})}async render(e){this.rootElement.innerHTML="";const t=document.createElement("div");Object.assign(t.style,{fontFamily:"Segoe UI, Tahoma, Geneva, Verdana, sans-serif",padding:"10px",maxWidth:"420px",border:"1px solid var(--border)",borderRadius:"8px",backgroundColor:"var(--surface)",color:"var(--text)"});const n=document.createElement("h3");n.textContent="Side Weights and Values Explanation",n.style.color="var(--primary)",t.appendChild(n);const o=document.createElement("p");o.textContent="This table shows the sides of the die, their associated weights, and their rolling probabilities. The weights determine how likely each side is to appear when rolled.",o.style.color="var(--text-muted)",t.appendChild(o);const i=e.xml.match(/SideWeights="([^"]+)"/),r=e.xml.match(/SideValues="([^"]+)"/);if(!i||!r){const e=document.createElement("p");return e.style.color="var(--error)",e.textContent="SideWeights or SideValues attributes not found in item XML.",t.appendChild(e),void this.rootElement.appendChild(t)}const s=i[1].split(" ").map(Number),l=r[1].split(" ").map(e=>e.trim());if(s.length!==l.length){const e=document.createElement("p");return e.style.color="var(--error)",e.textContent="SideWeights and SideValues lengths do not match.",t.appendChild(e),void this.rootElement.appendChild(t)}const c=new Map([["0","1"],["1","2"],["2","3"],["3","4"],["4","5"],["5","6"],["6","Devil's Head"]]),d=new Map([["1","Worth 100 points alone. Used in straights (1-5, 1-6). Triple 1s = 1000 points, doubles after triple double the score."],["2","Part of straights (1-5, 2-6). Triple 2s = 200 points, doubles after triple double the score."],["3","Part of straights (1-5, 2-6). Triple 3s = 300 points, doubles after triple double the score."],["4","Part of straights (1-5, 2-6). Triple 4s = 400 points, doubles after triple double the score."],["5","Worth 50 points alone. Used in straights (1-5, 1-6). Triple 5s = 500 points, doubles after triple double the score."],["6","Part of straight (2-6, 1-6). Triple 6s = 600 points, doubles after triple double the score."],["Devil's Head","Joker - can replace any value in a combination to complete a scoring set or straight."]]),p=l.map(e=>{const t=c.get(e);return t||e}),m=s.reduce((e,t)=>e+t,0),u=s.length,h=1/u,g=s.map(e=>m>0?e/m:0),f=document.createElement("table");Object.assign(f.style,{width:"100%",borderCollapse:"collapse"});const y=document.createElement("tr");[{text:"Side Value",tooltip:"The identifier or label for the die side."},{text:"Weight",tooltip:"The relative weight assigned to this side."},{text:"Rolling Probability",tooltip:"Chance this side is rolled: Weight √∑ Total Weights."}].forEach(({text:e,tooltip:t})=>{const n=document.createElement("th");n.textContent=e,Object.assign(n.style,{borderBottom:"2px solid var(--border)",padding:"8px",textAlign:"center",cursor:"help",color:"var(--primary)"}),n.dataset.tooltip=t,this.attachTooltipListeners(n),this.attachHoverListeners(n),y.appendChild(n)}),f.appendChild(y);for(let e=0;e<u;e++){const t=document.createElement("tr");e%2==1&&(t.style.backgroundColor="var(--highlight)");const n=document.createElement("td");n.textContent=p[e],n.dataset.tooltip=d.get(p[e])||"",Object.assign(n.style,{textAlign:"center",padding:"6px",color:"var(--accent)",fontWeight:"600"}),this.attachTooltipListeners(n),this.attachHoverListeners(n),t.appendChild(n);const o=document.createElement("td");o.textContent=s[e].toString(),Object.assign(o.style,{textAlign:"center",padding:"6px",color:"var(--text)"}),o.dataset.tooltip=`This side has a weight of ${s[e]}. Higher weights increase the chance this side appears.`,this.attachTooltipListeners(o),this.attachHoverListeners(o),t.appendChild(o);const a=g[e],i=document.createElement("td");Object.assign(i.style,{textAlign:"center",padding:"6px",color:"var(--text)"});const r=document.createElement("span");r.textContent=`${(100*a).toFixed(1)} %`,i.appendChild(r);let l="";(100*a).toFixed(1).endsWith(".0")||(l=` Probability: ${(100*a).toString()}`);const c=`Probability = Weight (${s[e]}) √∑ Total Weights (${m}). Out of ${m} total weight points, this side has ${s[e]}.${l}`;i.dataset.tooltip=c,this.attachTooltipListeners(i),this.attachHoverListeners(i),t.appendChild(i),f.appendChild(t)}if(t.appendChild(f),window.Highcharts){const e=document.createElement("div");e.style.height="300px",e.style.marginBottom="16px",t.appendChild(e),Highcharts.chart(e,{chart:{type:"pie",backgroundColor:"transparent"},title:{text:"Side Weight Distribution"},tooltip:{pointFormat:"<b>{point.percentage:.1f}%</b> ({point.weight} weight)"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"{point.name}: {point.percentage:.1f}%"}}},series:[{type:"pie",name:"Probability",data:p.map((e,t)=>({name:e,y:s[t],weight:s[t]}))}],credits:{enabled:!1}})}const b=document.createElement("section");Object.assign(b.style,{marginTop:"16px",padding:"12px",backgroundColor:"var(--highlight)",borderRadius:"8px",border:"1px solid var(--primary)",color:"var(--text)",fontSize:"0.9em",lineHeight:"1.4em",fontWeight:"500",userSelect:"none"});const w=document.createElement("h4");w.textContent="Automated Analysis",Object.assign(w.style,{marginTop:"0",marginBottom:"8px",color:"var(--primary)",fontWeight:"700",fontSize:"1.1em"}),w.dataset.tooltip="This is an automated analysis. Results can be inaccurate or wrong.",this.attachTooltipListeners(w),b.appendChild(w);const x=(e,t)=>{const n=document.createElement("span");return n.textContent=e,Object.assign(n.style,{backgroundColor:t,color:"#000",borderRadius:"12px",padding:"2px 8px",fontSize:"0.75em",fontWeight:"700",marginLeft:"6px",userSelect:"none"}),n},v=s.every(e=>e===s[0]);let C=s[0],E=s[0],S=[0],T=[0];for(let e=1;e<s.length;e++)s[e]<C?(C=s[e],S=[e]):s[e]===C&&S.push(e),s[e]>E?(E=s[e],T=[e]):s[e]===E&&T.push(e);const I=S.map(e=>p[e]).join(", "),k=T.map(e=>p[e]).join(", "),L=document.createElement("ul");if(L.style.paddingLeft="20px",L.style.margin="0",v){const e=document.createElement("li");e.textContent="All sides have equal weight, making this a fair die with equal rolling probabilities.",e.appendChild(x("Fair","var(--success)")),L.appendChild(e)}else{const e=document.createElement("li");e.textContent=`${k} have the highest weight (${E}), resulting in the highest probability (${(100*g[T[0]]).toFixed(1)}%).`,e.appendChild(x("High","var(--primary)")),L.appendChild(e);const t=document.createElement("li");t.textContent=`${I} have the lowest weight (${C}), resulting in the lowest probability (${(100*g[S[0]]).toFixed(1)}%).`,t.appendChild(x("Low","var(--warning)")),L.appendChild(t)}const A=g.map((e,t)=>e<.05?p[t]:void 0).filter(e=>void 0!==e),B=g.map((e,t)=>e>.3?p[t]:void 0).filter(e=>void 0!==e);if(A.length>0){const e=document.createElement("li");e.textContent=`Side(s) ${A.join(", ")} have very low probability (<5%), so they rarely roll.`,e.appendChild(x("Rare","var(--error)")),L.appendChild(e)}if(B.length>0){const e=document.createElement("li");e.textContent=`Side(s) ${B.join(", ")} have very high probability (>30%), making them very common.`,e.appendChild(x("Common","var(--accent)")),L.appendChild(e)}const M=document.createElement("li");M.textContent="Comparison to fair probability per side:",L.appendChild(M);const D=document.createElement("ul");D.style.paddingLeft="16px",D.style.marginTop="6px";for(let e=0;e<u;e++){const t=g[e]-h,n=(100*t).toFixed(1);let o="";o=t>.05?"significantly higher chance than fair.":t>.01?"slightly higher chance than fair.":t<-.05?"significantly lower chance than fair.":t<-.01?"slightly lower chance than fair.":"approximately fair chance.";const a=document.createElement("li");a.textContent=`${p[e]}: ${n}% (${o})`,D.appendChild(a)}L.appendChild(D),b.appendChild(L),t.appendChild(b);const P=document.createElement("p");Object.assign(P.style,{marginTop:"12px",fontSize:"0.9em",color:"var(--text-muted)"}),P.textContent="The sum of all weights determines the overall distribution of roll outcomes. This table and all contents are generated from the game files.";const $=document.createElement("p");Object.assign($.style,{marginTop:"12px",fontSize:"0.7em",color:"var(--text-muted)"});const N=document.createElement("em");N.textContent="Note: The probabilities shown are calculated based on the weights of the item and assume a simplified model. No game code has been reviewed to ensure this is accurate behaviour. Actual roll outcomes may vary due to additional game mechanics or rounding. This table may be inaccurate.",$.appendChild(N),t.appendChild(P),t.appendChild($),this.rootElement.appendChild(t),a.set("sideWeightsView",t)}},"Die");const H=6e4;let R;async function z(e){R&&(R.abort(),R=void 0);const t=new AbortController;R=t,function(e){const t=new URL(window.location.href);void 0===e||""===e?t.searchParams.delete("q"):t.searchParams.set("q",e);history.pushState(void 0,"",t.toString())}(e);const n=Math.random().toString(36).slice(2,10),o=Math.random().toString(36).slice(2,10);if(a.set("latestRenderToken",n),a.set("latestSearchToken",o),e.trim().length<1){const e=10;if(a.set("randomItemsCount",e),clearInterval(a.get("randomRefreshTimer")),a.set("randomRefreshTimer",void 0),a.get("firstSearch"))return void _();if(n!==a.get("latestRenderToken"))return;return void S(10,F("search"))}const i=/(!?)@(\w+)/g;i.lastIndex=0;const r=new Set,s=new Set;let l=i.exec(e);for(;null!==l;){const t="!"===l[1],n=l[2].toLowerCase();t?s.add(n):r.add(n),l=i.exec(e)}const c=/#(\w+):(?:"([^"\\]*(?:\\.[^"\\]*)*)"|(\S+))/g;c.lastIndex=0;const d={};let p=c.exec(e);for(;null!==p;){const t=p[1].toLowerCase();let n=p[2]??p[3]??"";n=n.replace(/\\"/g,'"').trim(),d[t]=n.toLowerCase(),p=c.exec(e)}const m=e.replace(i,"").replace(c,"").trim();try{if(a.get("firstSearch")){if(n!==a.get("latestRenderToken"))return;const e=a.get("xmlSizeInBytes");a.get("results").innerHTML=`\n                    <div class="welcome-message">\n                        <p>Searching through ${a.get("items").length} items</p>\n                        <p>Or about ${T(e)} of data</p>\n                        <p>The first search will always be slower</p>\n                    </div>\n                `,a.set("firstSearch",!1)}let i=[];if(""===m&&(r.size>0||s.size>0||Object.keys(d).length>0))i=a.get("items").filter(e=>{const t=e.type.toLowerCase(),n=0===r.size||r.has(t),o=!s.has(t),a=Object.entries(d).every(([t,n])=>void 0!==e[t]&&String(e[t]).toLowerCase().includes(n));return n&&o&&a});else{if(o!==a.get("latestSearchToken"))return;await a.get("index").search(m,{enrich:!0,suggest:!0}).then(l=>{if(t.signal.aborted)return;if(o!==a.get("latestSearchToken"))return;const c=[];for(const e of l)if(e.result&&Array.isArray(e.result))for(const t of e.result)"object"==typeof t&&void 0!==t.id&&void 0!==t.score?c.push(t):"number"!=typeof t&&"string"!=typeof t||c.push({id:t,score:1});const p=m.toLowerCase(),u=a.get("items").find(e=>e.id.toLowerCase().startsWith(p));u&&c.push({id:u.uid,score:999});const h=a.get("items").find(e=>e.rawName.toLowerCase().startsWith(p));h&&c.push({id:h.uid,score:998});const g=a.get("items").find(e=>e.name.toLowerCase().startsWith(p));if(g&&c.push({id:g.uid,score:997}),0===c.length){if(n!==a.get("latestRenderToken"))return;return void(a.get("results").innerHTML=`<div class="no-results">No items found for "${e}"</div>`)}const f=new Map;for(const e of c){const t=f.get(e.id)??-1/0;e.score>t&&f.set(e.id,e.score)}const y=[...f.entries()].sort((e,t)=>t[1]-e[1]).map(([e])=>e);i=y.map(e=>a.get("items").find(t=>t.uid===e)).filter(Boolean),(r.size>0||s.size>0||Object.keys(d).length>0)&&(i=i.filter(e=>{const t=e.type.toLowerCase(),n=0===r.size||r.has(t),o=!s.has(t),a=Object.entries(d).every(([t,n])=>void 0!==e[t]&&String(e[t]).toLowerCase().includes(n));return n&&o&&a}))})}if(n!==a.get("latestRenderToken"))return;if(t.signal.aborted)return;C(i,e,m)}catch(e){console.error("Search error:",e),a.get("results").innerHTML='<div class="error">Search failed. Please try again.</div>'}}function F(e){const t=Math.floor(Date.now()/H);let n=0;for(let t=0;t<e.length;t++)n=31*n+e.charCodeAt(t)|0;return t^n}function _(){a.get("results").innerHTML=`\n        <div class="welcome-message">\n            <h3>Item ID Search</h3>\n            <p>${a.get("items").length} items loaded</p>\n            <p>Start typing to search by name, ID, or type</p>\n            <button id="showRandomBtn">Show Trending Items</button>\n        </div>\n    `,document.getElementById("showRandomBtn")?.addEventListener("click",async()=>{a.set("firstSearch",!1),await z("")})}async function W(e,t=100,n=0){return new Promise(o=>{!function(){const e=document.getElementById("indexingProgressRandomMessage");if(!e)return;const t=Math.floor(Math.random()*a.get("randomIndexingMessages").length);e.textContent=a.get("randomIndexingMessages")[t]}();let i=0;const r=[],s=e.length;a.get("indexingProgressContainer").style.display="block",a.get("indexingProgress").value=0,a.get("indexingPercent").textContent="0%";const l=()=>{const c=Math.min(i+t,s),d=a.get("localizedMap");for(let t=i;t<c;t++){const o=e[t],i=o.tagName,s=o.getAttribute("Name")||"N/A",l=o.getAttribute("UIName")||o.getAttribute("UiName")||"N/A",c=d[l]||s,p=o.getAttribute("UIInfo")||o.getAttribute("UiInfo")||"N/A",m=d[p]||p;a.get("typeColors").has(i)||a.get("typeColors").set(i,I(i)),a.get("nameColors").has(c)||a.get("nameColors").set(c,I(c));const u=[...o.attributes].map(e=>`${e.name}:${e.value}`).join(" "),h={uid:n+t,tag:i,name:c,rawName:s,rawUIName:l,info:m,id:o.getAttribute("Id")||"N/A",type:i,xml:o.outerHTML,all:u,typeColor:a.get("typeColors").get(i),nameColor:a.get("nameColors").get(c),__sourceFile:o.__sourceFile||"unknown"};a.get("index").add(h),r.push(h)}i=c;const p=Math.round(i/s*100);if(a.get("indexingProgress").value=p,a.get("indexingPercent").textContent=`${p}%`,i<s)"requestIdleCallback"in window?requestIdleCallback(l):setTimeout(l,0);else{a.get("indexingProgressContainer").style.display="none",a.get("items").push(...r);const e=new Set(a.get("allTypes"));for(const t of a.get("items"))e.add(t.type);a.set("allTypes",[...e].sort());if(a.get("items")){const e=function(e){const t={},n={},o={},i={},r={};if(!a.get("flags").enableItemStatistics)return{nameWordCounts:t,infoWordCounts:n,fileCounts:o,correlation:i,typeCounts:r};for(const a of e){const e=y(a.name||"");for(const n of e)t[n]=(t[n]||0)+1;const s=y(a.info||"");for(const e of s)n[e]=(n[e]||0)+1;const l=a.__sourceFile||"unknown";o[l]=(o[l]||0)+1,i[a.type]||(i[a.type]={});for(const e of s)i[a.type][e]=(i[a.type][e]||0)+1;r[a.type]=(r[a.type]||0)+1}return{nameWordCounts:t,infoWordCounts:n,fileCounts:o,correlation:i,typeCounts:r}}(r);h.setData(e)}_(),o(r)}};"requestIdleCallback"in window?requestIdleCallback(l):setTimeout(l,0)})}async function O(e,t){const n=[`Localization/${e}_xml/text_ui_items.xml`,`Localization/${e}_xml/text_ui_menus.xml`],o={};try{const e=new Set;t.forEach(t=>{const n=t.getAttribute("UIName")||t.getAttribute("UiName"),o=t.getAttribute("UIInfo")||t.getAttribute("UiInfo");n&&e.add(n),o&&e.add(o)});for(const t of n){const n=await d("./api/proxy.php",{action:"fetch",resource:t});if(!n.ok)throw new Error(`Failed to load ${t}`);const a=n.content,i=[...(new DOMParser).parseFromString(a,"application/xml").querySelectorAll("Row")];for(const t of i){const n=[...t.querySelectorAll("Cell")],a=n[0]?.textContent?.trim(),i=n[1]?.textContent?.trim()||"",r=n[2]?.textContent?.trim()||i;a&&e.has(a)&&(o[a]=r)}}a.set("localizedMap",o)}catch(e){console.error("Error loading localization:",e),a.set("localizedMap",{})}}const U={alchemybase:"Different bases for the alchemy mechanic (internal)",ammo:"Arrows, bolts and other ammunition",armor:"Armor and other clothing items",craftingmaterial:"Crafting Materials",dicebadge:"Dice Badges",die:"Dice",document:"Books, scrolls and other documents that can be read",food:"Food Items",helmet:"Helmets",herb:"Herbs",hood:"Hoods",itemalias:"Aliased items (items with aliased names), usually used within quests",key:"Keys",keyring:"Keyrings",meleeweapon:"Swords, shields and most other weapons",miscitem:"Miscellaneous Items",missileweapon:"Bows, crossbows, guns, and other ranged weapons",money:"Groschen",npctool:"Tools used by NPCs, cannot be used",ointment:"Ointments",pickableitem:"Unknown",poison:"Poisons, other potions are in @Food",quickslotcontainer:"Pouches"},q={uid:"Internal field. This displays the order of which the items are indexed",id:"The in-game item ID of the item",name:"The item name in your selected language",rawname:"The Name attribute inside the item's XML",rawuiname:"The localization string of the item",type:"The item type. Consider using @Type instead",info:"The item description",xml:"The item's original XML",tag:"Same as type. This is deprecated.",all:'A specific value within the XML in "Attribute:Value ..." format. You can chain multiple attributes with a space.',typecolor:"The generated color associated with the item type.",namecolor:"The generated color associated with the item."};function j(){const e=a.get("typeAutocomplete"),t=a.get("autocompleteInfoPopup");let n,o,i=0,r=0;function s(e,t,n){return e+(t-e)*n}function l(){if(!n)return;const e=n.getBoundingClientRect(),a=t.getBoundingClientRect(),c=e.right+30+window.scrollX,d=window.scrollX+window.innerWidth-a.width-10,p=Math.min(c,d),m=e.top+window.scrollY+e.height/2-a.height/2,u=window.scrollY+10,h=window.scrollY+window.innerHeight-a.height-10,g=Math.min(Math.max(m,u),h);i=s(i,p,.15),r=s(r,g,.15),t.style.left=`${i}px`,t.style.top=`${r}px`,o=Math.abs(i-p)>.5||Math.abs(r-g)>.5?requestAnimationFrame(l):void 0}function c(e){if(n===e)return;n=e;const a=e.dataset.description||"No description available.";if(t.textContent=a,t.style.display="block",!t.style.left||!t.style.top){const n=e.getBoundingClientRect();i=n.right+30+window.scrollX,r=n.top+window.scrollY+n.height/2,t.style.left=`${i}px`,t.style.top=`${r}px`}o||(o=requestAnimationFrame(l))}function d(a){const i=a.relatedTarget;i&&(e.contains(i)||t.contains(i))||(t.style.display="none",n=void 0,o&&(cancelAnimationFrame(o),o=void 0))}a.get("typeAutocomplete").addEventListener("click",e=>{const t=e.target,n=t.dataset.type,o=t.dataset.symbol;if(!n||!o)return;const i=a.get("searchBox").value;let r;if("@"===o)r=i.replace(/@(\w*)$/,`@${n} `);else{if("#"!==o)return;r=i.replace(/#(\w*)$/,`#${n}:`)}a.get("searchBox").value=r,a.get("typeAutocomplete").style.display="none",a.get("searchBox").focus(),z(a.get("searchBox").value.trim())});const p={x:0,y:0};document.addEventListener("mousemove",e=>{p.x=e.clientX,p.y=e.clientY}),e.addEventListener("mouseover",e=>{const t=e.target;t.classList.contains("autocomplete-item")&&c(t)}),e.addEventListener("scroll",()=>{!function(){const e=document.elementFromPoint(p.x,p.y);e?.classList.contains("autocomplete-item")?c(e):a.get("autocompleteInfoPopup").style.display="none"}()}),e.addEventListener("mouseout",d),t.addEventListener("mouseout",d)}function X(){a.get("searchBox").addEventListener("input",async()=>{const e=a.get("searchBox").value;let t;z(e.trim());let n=[],o="",i="";if(t=e.match(/@(\w*)$/),t){const e=t[1].toLowerCase();i="@",o=e,n=a.get("allTypes").filter(t=>t.toLowerCase().startsWith(e))}if(!t&&(t=e.match(/#(\w*)$/),t)){const e=t[1].toLowerCase();i="#",o=e;n=Object.keys(a.get("items")[0]||{}).filter(t=>t.toLowerCase().startsWith(e))}if(t&&n.length>0){if(1===n.length&&n[0].toLowerCase()===o)return void(a.get("typeAutocomplete").style.display="none");a.get("typeAutocomplete").innerHTML=n.map(e=>{const t=("@"===i?U:"#"===i?q:{})[e.toLowerCase()]||"No description available.";return`\n                        <div class="autocomplete-item" \n                             data-type="${e}" \n                             data-symbol="${i}"\n                             data-description="${t.replace(/"/g,"&quot;")}">\n                            ${i}${e}\n                        </div>\n                    `}).join("");const e=a.get("searchBox").getBoundingClientRect();a.get("typeAutocomplete").style.top=`${e.bottom+window.scrollY}px`,a.get("typeAutocomplete").style.left=`${e.left+window.scrollX}px`,a.get("typeAutocomplete").style.width=`${e.width}px`,a.get("typeAutocomplete").style.display="block"}else a.get("typeAutocomplete").style.display="none";a.get("randomRefreshTimer")&&(clearInterval(a.get("randomRefreshTimer")),a.set("randomRefreshTimer",void 0))}),a.get("results").addEventListener("click",e=>{const t=e.target.closest(".result-item");if(t){a.get("randomItemsContainer").hidden=!0;const e=parseInt(t.dataset.uid,10);Y(e);const n=a.get("items").find(t=>t.uid===e);n&&$(n)}}),a.get("randomItemsContainer").addEventListener("click",e=>{const t=e.target.closest(".result-item");if(t){a.get("randomItemsContainer").hidden=!0;const e=parseInt(t.dataset.uid,10);Y(e);const n=a.get("items").find(t=>t.uid===e);n&&$(n)}}),a.get("closeDetailPanelBtn").addEventListener("click",()=>{a.get("itemInfo").innerHTML="",a.get("viewsContainer")&&(a.get("viewsContainer").hidden=!0),N(3,F("details")),a.get("randomItemsContainer").hidden=!1,a.set("selectedItemInDetailsPanel",void 0),Y(void 0)}),a.get("languageSelect").addEventListener("change",async()=>{a.set("selectedLang",a.get("languageSelect").value),a.get("results").innerHTML="";const e=a.get("selectedLang"),t=a.get("allItemsXML");t&&await O(e||"English",t),await async function(){a.get("index").clear(),a.get("typeColors").clear(),a.get("nameColors").clear();const e=document.implementation.createDocument(null,"ItemClasses");for(const t of a.get("items")){const n=(new DOMParser).parseFromString(t.xml,"application/xml").documentElement;e.documentElement.appendChild(n)}const t=[...e.documentElement.children];a.set("items",await W(t))}(),a.get("searchBox").dispatchEvent(new Event("input"));const n=a.get("selectedItemInDetailsPanel");if(void 0!==n){const e=n;Y(e);const t=a.get("items").find(t=>t.uid===e);t&&$(t)}}),j(),a.get("openHomeButton").addEventListener("click",e=>{a.get("randomItemsContainer").hidden=!0,a.get("viewsContainer")&&(a.get("viewsContainer").hidden=!0),a.get("itemInfo").innerHTML=a.get("homePage"),a.set("selectedItemInDetailsPanel",void 0),Y(void 0),b()}),document.addEventListener("visibilitychange",()=>{document.hidden||""!==a.get("searchBox").value.trim()||a.get("firstSearch")||z("")})}function Y(e){const t=new URL(window.location.href);void 0===e?t.searchParams.delete("item"):t.searchParams.set("item",e.toString()),history.pushState(void 0,"",t.toString())}async function J(){!function(){const e=new URLSearchParams(window.location.search),t=decodeURIComponent(e.get("q")||"");t&&(a.get("searchBox").value=t)}();const e=document.createElement("div");e.id="typeAutocomplete",document.body.appendChild(e),a.set("typeAutocomplete",e);const t=document.createElement("div");t.id="autocomplete-info-popup",Object.assign(t.style,{position:"absolute",background:"#222",color:"white",padding:"6px 10px",borderRadius:"4px",boxShadow:"0 2px 6px rgba(0,0,0,0.5)",display:"none",pointerEvents:"none",maxWidth:"300px",zIndex:"10000",fontSize:"0.9em",lineHeight:"1.2"}),document.body.appendChild(t),a.set("autocompleteInfoPopup",t);const n=a.get("languages");for(const[e,t]of Object.entries(n)){const n=document.createElement("option");n.value=e,n.textContent=t,e===a.get("selectedLang")&&(n.selected=!0),a.get("languageSelect").appendChild(n)}a.set("index",new FlexSearch.Document({tokenize:"full",cache:!0,context:{resolution:5,depth:3,bidirectional:!0},resolution:9,worker:!0,document:{id:"uid",index:[{field:"name",encoder:new FlexSearch.Encoder({normalize:!0,dedupe:!0,cache:!0,include:{letter:!0,number:!0,symbol:!1,punctuation:!1,control:!1,char:""}})},{field:"rawName",encoder:new FlexSearch.Encoder({normalize:!0,dedupe:!0,cache:!0,include:{letter:!0,number:!0,symbol:!0,punctuation:!1,control:!1,char:""}})},{field:"info",encoder:new FlexSearch.Encoder({normalize:!0,dedupe:!0,cache:!0,include:{letter:!0,number:!0,symbol:!1,punctuation:!1,control:!1,char:""}})},{field:"id",encoder:new FlexSearch.Encoder({normalize:!0,dedupe:!0,cache:!0,include:{letter:!0,number:!0,symbol:!0,punctuation:!1,control:!1,char:""}})},{field:"type",encoder:new FlexSearch.Encoder({normalize:!0,dedupe:!0,cache:!0,include:{letter:!0,number:!0,symbol:!1,punctuation:!1,control:!1,char:""}})},{field:"all",encoder:new FlexSearch.Encoder({normalize:!0,dedupe:!0,cache:!0,include:{letter:!0,number:!0,symbol:!0,punctuation:!1,control:!1,char:""}})}]}}));const o=await async function(e=["Data/Libs/Tables/item/item.xml","Data/Libs/Tables/item/item__alchemy.xml","Data/Libs/Tables/item/item__autotests.xml","Data/Libs/Tables/item/item__aux.xml","Data/Libs/Tables/item/item__deprecated.xml","Data/Libs/Tables/item/item__dlc.xml","Data/Libs/Tables/item/item__horse.xml","Data/Libs/Tables/item/item__reward.xml","Data/Libs/Tables/item/item__rewards.xml","Data/Libs/Tables/item/item__system.xml","Data/Libs/Tables/item/item__test.xml","Data/Libs/Tables/item/item__unique.xml"]){try{const t=await Promise.all(e.map(e=>d("./api/proxy.php",{action:"fetch",resource:e}).then(e=>e.content))),n=t.reduce((e,t)=>e+(new TextEncoder).encode(t).length,0);a.set("xmlSizeInBytes",n);const o=[];for(let n=0;n<t.length;n++){const a=t[n],i=e[n],r=i.split("/").pop()||i,s=[...(new DOMParser).parseFromString(a,"application/xml").querySelectorAll("ItemClasses > *")];for(const e of s)e.__sourceFile=r,o.push(e)}return o}catch(e){console.error("Error loading XML:",e),a.get("results").innerHTML='<div class="error">Failed to load item data. Please try again later.</div>'}}();if(a.set("allItemsXML",o),o){const e=a.get("selectedLang");e&&await O(e||"English",o),a.set("items",await W(o))}X(),a.get("detailPanel").addEventListener("copy",e=>{const t=window.getSelection();if(!t||t.isCollapsed)return;const n=t.toString().replace(/\s+/g," ").trim();e.clipboardData.setData("text/plain",n),e.preventDefault()}),function(){const e=H,t=()=>{const t=Math.floor(Date.now()/e);a.get("searchBox").value.trim()||a.get("firstSearch")||S(10,t),N(3,t)},n=Date.now();setTimeout(()=>{t(),a.set("globalTickTimer",setInterval(t,e))},e-n%e)}(),function(){const e=new URLSearchParams(window.location.search),t=decodeURIComponent(e.get("q")||"");t&&z(t)}(),function(){const e=new URLSearchParams(window.location.search).get("item")||"",t=decodeURIComponent(e).trim();if(t){const e=Number(t);if(Number.isNaN(e))console.warn(`Item query parameter is not a valid number: ${t}`);else{a.get("randomItemsContainer").hidden=!0;const t=document.getElementById("patchNotesContainer");t&&(t.hidden=!0);const n=e;a.set("selectedItemInDetailsPanel",n),Y(n);const o=a.get("items").find(e=>e.uid===n);o&&$(o)}}}(),b()}},5661:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},5676:()=>{"use strict";const e=JSON.parse('{"2.1.2":{"title":"Patch 1.4 Support","content":"<h3>Features</h3>\\n\\n<ul>\\n<li><strong>Updated game data for Patch 1.4</strong> - all the new items with full localization support</li>\\n<li>Fixed an API issue caused by Windows</li>\\n<li>Make it so that you can no longer click on summarize button (in theory, can&#39;t test until I upload it to GitHub)</li>\\n</ul>\\n"},"2.1.1":{"title":"Item Statistics and Compatibility Fixes","content":"<h3>Features</h3>\\n<ul>\\n<li><strong>feat: item statistics and charts üìä (and one for dice as well)</strong></li>\\n<li><strong>feat: add support for non-https and older browsers for obfFetch</strong></li>\\n<li><strong>feat(backend): added support for AES-256-CBC (crypto-js doesn&#39;t support GCM)</strong></li>\\n<li>Replace all null to undefined when it&#39;s safe to do so (might cause bugs actually)</li>\\n<li>Templates got updated</li>\\n</ul>\\n<p>Yes this update is actually boring I feel like everything I need is already added except for the game map but that&#39;s not really possible</p>\\n"},"2.1.0":{"title":"New Document View","content":"<h3>Features</h3>\\n<ul>\\n<li>‚ú® Document View with image support</li>\\n<li>Experimental AI features (currently unusable, for me only)</li>\\n<li>Resource proxy changes</li>\\n</ul>\\n<h4>Document View</h4>\\n<p>Currently supports most of the documents in the game, maps are rendered but usually split into multiple parts. It is not an accurate representation of what is shown in-game and just shows the content inside of it.</p>\\n<p>The current code for image updating needs to be optimized, it makes too much fetch requests. Also the document won&#39;t be rendered until the images all load, which could be slow for documents with a lot of images. A fix for this is coming soon.</p>\\n"},"2.0.1":{"title":"Search tokenizer changes","content":"<ul>\\n<li>Changed search tokenizer to &quot;full&quot;</li>\\n<li>Attempted to fix search performance</li>\\n<li>Added new view for dice showing probability</li>\\n</ul>\\n"},"2.0.0":{"title":"2.0 Rewrite","content":"<p>The goal of this rewrite is to introduce better type safety (numerous would-be bugs have already been found!) and modularize the entire application. Most of the refactoring is complete and there is only debugging the current code, and then new features can be implemented.  </p>\\n<p>This rewrite is still ongoing if there are no newer patch notes.  </p>\\n<p>Below are some features that are currently considered:</p>\\n<ul>\\n<li>Modular data processing - being able to create more data viewers other than the XML viewer</li>\\n<li>More interactive CSS</li>\\n<li>Better patch notes editor (this is unrelated to the main project, just the patch notes)</li>\\n</ul>\\n<h2>Implemented Features</h2>\\n<ul>\\n<li>State class to replace variables</li>\\n<li>CSS improvements (we&#39;re partially there)</li>\\n<li>Numerous firstSearch logic fixes</li>\\n<li>Other small bug fixes</li>\\n<li>Build system overhaul</li>\\n<li>Search query parameter - searches now preserve after page reloads</li>\\n</ul>\\n"},"1.3.1":{"title":"üêõ Bug Fix and Build System Changes","content":"<p>This update is relatively minor and only fixes a single bug, but also introduces a new build system which allows code to be more modular.</p>\\n<ul>\\n<li>üêõ Fixed a bug where random items gets shown regardless in an update (60s)</li>\\n<li>üë∑ Use webpack internally to compile all JS files</li>\\n</ul>\\n"},"1.3.0":{"title":"Support for other item types","content":"<p>This update implements support for more item types. The extra rewards implementation has also been fixed to provide proper item information.</p>\\n<h3>Changes</h3>\\n<ul>\\n<li>‚ú® Added support for additional item types not included in the main item.xml</li>\\n<li>üêõ Fixed extra rewards and the improper implementation</li>\\n<li>üé® Beautified code and minor code cleanup</li>"},"1.2.0":{"title":"üìù Item Descriptions and Extra Rewards Data","content":"<p>It has come to my attention that the PROS rewards along with some extra rewards are not available through this tool. Apparently, they are in a separate XML and completely independent from the main item.xml file. This update aims to provide support for the extra rewards, making them searchable and available.</p><p>This update also implements item descriptions, scraped through the same method I use for the item names. This feature is its experimental stage, and might not work as intended for all items. Changing your localization might not update the description.</p><h3>Changes</h3><ul><li>Implemented item descriptions</li><li>Implemented support for ExtraRewards/ExtraRewardData</li></ul><h3>Known / Possible Issues that will not be fixed</h3><ul><li>Item descriptions not updating during language change, this can be partially fixed by not changing the language often and clicking on the result again.</li><li>The type for extra rewards item is currently ExtraRewardData because that was how the system worked. A hard-coded solution is required if it needs to be changed to ExtraReward. For now, this will not be fixed.</li></ul>"},"1.1.2":{"title":"‚ö°Ô∏è Reindexing Performance Improvements","content":"<p>Reindexing now uses our new batch indexing system which reduces the lag when changing languages. Note that the more languages you select in one session the more memory the site will use.</p>"},"1.1.1":{"title":"‚ö°Ô∏è Performance Fixes","content":"<p>The results list now utilize <b>virtual scrolling</b> to deliver much better performance and can now display a much bigger list of items without lag. The site also stops freezing during indexing.</p><h3>Known Issues</h3><ul><li>Lag spikes still occur during language change, this is being investigated and will most likely have a fix in the next update.</li><li>Dragging the scrollbar might have some positioning issues, however, this is a problem with Clusterize.js lists and will not be fixed in the near future.</li></ul><h3>Changes</h3><ul><li>Implemented virtual scrolling</li><li>Other rendering performance optimizations</li><li>Added patch notes system (yeah, this was implemented after release)</li></ul>"},"1.1.0":{"title":"üåê Localization Update","content":"<p>This update now allows you to search through the list of items with their <b>in game name</b> in any language! Other formats such as the string ID, item ID and type will still work normally.</p><ul><li>Several UX improvements</li><li>Added localized search</li><li>\\"Trending Items\\" menu (not really)</li></ul>"},"1.0.0":{"title":"Initial Release","content":"<ul><li>Added basic search functionality</li><li>XML attributes support</li><li>Basic search indexing</li><ul>"}}');(async()=>{const t=document.getElementById("patchNotesContainer");t&&(document.getElementById("openHomeButton")?.addEventListener("click",()=>{t.hidden=!1}),document.getElementById("closeDetailPanelBtn")?.addEventListener("click",()=>{t.hidden=!0}),document.getElementById("results")?.addEventListener("click",e=>{const n=e.target?.closest(".result-item");n&&(t.hidden=!0)}),document.getElementById("randomItemsContainer")?.addEventListener("click",e=>{const n=e.target?.closest(".result-item");n&&(t.hidden=!0)}),async function(t){const n=t;if(!n)return;const o=n.attachShadow({mode:"open"}),a=document.createElement("style");a.textContent="\n        * {\n            /*\n            box-sizing: border-box;\n            font-family: sans-serif;\n            border: 1px solid #ccc;\n            background: $f9f9f9;\n            padding: 1em;\n            max-width: 600px;\n            */\n        }\n        /*\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        */\n        h2 {\n            margin: 0;\n            font-size: 1.2em;\n        }\n        select {\n            background-color: #2e2e2e;\n            color: #f0f0f0;\n            border: 1px solid #444;\n            border-radius: 6px;\n            padding: 6px 10px;\n            font-size: 1rem;\n            appearance: none;\n            margin-left: 1em;\n        }\n        select:hover {\n            background-color: #383838;\n            border-color: #666;\n        }\n        small {\n            display: block;\n            margin-bottom: 0.5em;\n        }\n    ",o.appendChild(a),await async function(t){if(!t)return;try{const n=Object.keys(e).sort((e,t)=>t.localeCompare(e,void 0,{numeric:!0})),o=n[0],a=document.createElement("label");a.textContent="Version",a.style.marginRight="1em";const i=document.createElement("select");i.id="versionSelect",i.style.marginLeft="auto",n.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,i.appendChild(t)});const r=document.createElement("div");r.appendChild(a),r.appendChild(i);const s=document.createElement("div");function l(t){const n=e[t];if(!n)return;s.innerHTML="";const o=document.createElement("div");o.classList.add("header"),o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="space-between",o.style.gap="1em";const a=document.createElement("h2");a.textContent=n.title,o.appendChild(a),o.appendChild(r);const i=document.createElement("div");i.innerHTML=`\n                ${t?`<small><strong>Version:</strong> ${t}</small><br>`:""}\n                <div>${n.content}</div>\n            `,s.appendChild(o),s.appendChild(i)}s.id="notesContent",s.style.marginTop="1em",t.appendChild(s),i.value=o,l(o),i.addEventListener("change",()=>l(i.value))}catch(c){console.error(`Failed to load patch notes: ${c}`),t.textContent="Could not load patch notes."}}(o)}(t))})()},6501:(e,t,n)=>{"use strict";function o(){const e=new URLSearchParams(window.location.search).get("license")||"";let t=!0;return"false"===decodeURIComponent(e).trim().toLowerCase()&&(t=!1),window.location.hostname.endsWith("github.io")&&(t=!1),t||console.warn(function(e){const t=e.split("\n"),n=t.filter(e=>e.trim()).reduce((e,t)=>Math.min(e,t.match(/^ */)?.[0].length??0),1/0);return t.map(e=>e.slice(n)).join("\n").trim()}("\n                Highcharts has been disabled\n                ---------------------------------\n                To comply with the Highcharts license, Highcharts has been disabled.\n                If you are in a testing environment or on GitHub Pages, this is expected behaviour.\n                This should not happen with the live version of the site.\n                ---------------------------------\n                To fix this in a testing environment, remove the license query parameter.\n                However, bypassing this is against the Highcharts license. Don't do it.\n                ---------------------------------\n                window.Highcharts should be set to undefined, and the Highcharts API will be inaccessible.\n                This is not a bug, but all errors after this saying Highcharts is undefined IS a bug.\n                Please report this if you see any other errors relating to Highcharts.\n                ---------------------------------\n                All Highcharts code will be disabled.\n            ")),t}n.d(t,{c:()=>o})},6592:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},6907:(e,t,n)=>{"use strict";n.a(e,async(e,t)=>{try{var o=n(6501),a=(n(286),n(1688),n(5226),n(5692),n(3997));window.CryptoJS||(window.CryptoJS=a),(0,o.c)()&&(await n.e(141).then(n.t.bind(n,9141,23)),await n.e(602).then(n.t.bind(n,9602,23)),await n.e(888).then(n.t.bind(n,8888,23)),await n.e(297).then(n.t.bind(n,7297,23)),await n.e(154).then(n.t.bind(n,5154,23)),await n.e(718).then(n.t.bind(n,3718,23)),await n.e(237).then(n.t.bind(n,3618,23)),await n.e(716).then(n.t.bind(n,2716,23)),await n.e(699).then(n.t.bind(n,7699,23)),await n.e(205).then(n.t.bind(n,6205,23)),await n.e(587).then(n.t.bind(n,2587,23)),window.Highcharts=window._Highcharts),t()}catch(e){t(e)}},1)},7780:(e,t,n)=>{"use strict";n.a(e,async(e,t)=>{try{var o=n(7589),a=n(5439),i=(n(5676),n(6907)),r=e([i]);i=(r.then?(await r)():r)[0],(async()=>{await(0,o.M)(),await(0,a.T)()})(),t()}catch(e){t(e)}})},8628:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,o,a,i){"string"==typeof e&&(e=[[null,e,void 0]]);var r={};if(o)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(r[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);o&&r[d[0]]||(void 0!==i&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=i),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),a&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=a):d[4]="".concat(a)),t.push(d))}},t}},9429:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var a=void 0!==n.layer;a&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,a&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var i=n.sourceMap;i&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}}]);