(()=>{"use strict";function e(...e){console.log(...function(e,t="#2196f3"){return[`%c${e}%c`,`background:${t};color:white;padding:2px 6px;border-radius:4px;font-weight:bold;`,""]}("WORKER","#4caf50"),"[ItemStatisticsWorker]",...e)}function t(t){e("Progress:",t),self.postMessage({type:"progress",progress:t})}function s(e){return String(e).toLowerCase()}function o(e){return Object.entries(e).sort((e,t)=>t[1]-e[1])}self.addEventListener("message",n=>{e("Received message:",n.data);const r=n.data||{};if("process"===r.cmd){const n=r.stats||{nameWordCounts:{},infoWordCounts:{},fileCounts:{},correlation:{},typeCounts:{}},a=r.options||{};e("Starting processStats with",{names:Object.keys(n.nameWordCounts).length,infos:Object.keys(n.infoWordCounts).length,files:Object.keys(n.fileCounts).length,correlations:Object.keys(n.correlation).length,types:n.typeCounts?Object.keys(n.typeCounts).length:0}),async function(n,r){try{const a=r.topWords??250;t(0);const c=o(n.nameWordCounts||{});e("Sorted name entries:",c.length);const i=c.slice(0,a).map(([e,t])=>({name:e,value:t}));t(15);const p=o(n.infoWordCounts||{}).slice(0,a).map(([e,t])=>({name:e,value:t}));t(30);const l=o(n.fileCounts||{}).map(([e,t])=>({name:e,y:t}));t(45);const f=o(n.typeCounts||{}).map(([e,t])=>({name:e,y:t}));e("Types data:",f),t(50);const u=n.correlation||{},d=Object.keys(u);e("Correlation types:",d.length);const g=Object.create(null);for(const e of d){const t=u[e]||{};for(const[e,o]of Object.entries(t)){const t=s(e);g[t]=(g[t]||0)+(Number(o)||0)}}const m=Object.entries(g).sort((e,t)=>t[1]-e[1]),y=r.topHeatmapWords??100,h=m.slice(0,y).map(([e])=>e);t(60),e("Selected heatmap words:",h.length);const C=r.maxTypes??100,b=d.slice(0,C),O=Object.create(null);h.forEach((e,t)=>{O[e]=t});const j=[];for(let e=0;e<b.length;e++){const s=u[b[e]]||{};for(const t of h){const o=s[t]||s[t.toLowerCase()]||0;o&&j.push([O[t],e,o])}e%20==0&&(await new Promise(e=>setTimeout(e,0)),t(60+Math.round(e/b.length*30)))}t(95),e("Heatmap data points:",j.length);const k={nameTreemap:i,infoTreemap:p,filesPie:l,typesPie:f,heatmap:{types:b,words:h,data:j}};t(100),self.postMessage({type:"done",payload:k}),e("Posted final payload")}catch(t){const s=t instanceof Error?t.stack||t.message:String(t);e("Caught error in processStats:",s),self.postMessage({type:"error",error:s})}}(n,a).catch(t=>{const s=t instanceof Error?t.stack||t.message:String(t);e("Error inside processStats:",s),self.postMessage({type:"error",error:s})})}})})();