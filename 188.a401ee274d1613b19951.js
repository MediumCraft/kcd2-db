(()=>{"use strict";function e(...e){console.log(...function(e,t="#2196f3"){return[`%c${e}%c`,`background:${t};color:white;padding:2px 6px;border-radius:4px;font-weight:bold;`,""]}("WORKER","#4caf50"),"[ItemStatisticsWorker]",...e)}function t(t){e("Progress:",t),self.postMessage({type:"progress",progress:t})}function s(e){return String(e).toLowerCase()}function o(e){return Object.entries(e).sort((e,t)=>t[1]-e[1])}self.addEventListener("message",n=>{e("Received message:",n.data);const r=n.data||{};if("process"===r.cmd){const n=r.stats||{nameWordCounts:{},infoWordCounts:{},fileCounts:{},correlation:{}},a=r.options||{};e("Starting processStats with",{names:Object.keys(n.nameWordCounts).length,infos:Object.keys(n.infoWordCounts).length,files:Object.keys(n.fileCounts).length,correlations:Object.keys(n.correlation).length}),async function(n,r){try{const a=r.topWords??250;t(0);const c=o(n.nameWordCounts||{});e("Sorted name entries:",c.length);const i=c.slice(0,a).map(([e,t])=>({name:e,value:t}));t(15);const l=o(n.infoWordCounts||{});e("Sorted info entries:",l.length);const p=l.slice(0,a).map(([e,t])=>({name:e,value:t}));t(30);const f=o(n.fileCounts||{});e("File entries:",f.length);const d=f.map(([e,t])=>({name:e,y:t}));t(45);const g=n.correlation||{},u=Object.keys(g);e("Correlation types:",u.length);const m=Object.create(null);for(const e of u){const t=g[e]||{};for(const[e,o]of Object.entries(t)){const t=s(e);m[t]=(m[t]||0)+(Number(o)||0)}}const h=Object.entries(m).sort((e,t)=>t[1]-e[1]),y=r.topHeatmapWords??100,b=h.slice(0,y).map(([e])=>e);t(60),e("Selected heatmap words:",b.length);const C=r.maxTypes??100,O=u.slice(0,C),S=Object.create(null);b.forEach((e,t)=>S[e]=t);const j=[];for(let e=0;e<O.length;e++){const s=g[O[e]]||{};for(const t of b){const o=s[t]||s[t.toLowerCase()]||0;o&&j.push([S[t],e,o])}e%20==0&&(await new Promise(e=>setTimeout(e,0)),t(60+Math.round(e/O.length*30)))}t(95),e("Heatmap data points:",j.length);const W={nameTreemap:i,infoTreemap:p,filesPie:d,heatmap:{types:O,words:b,data:j}};t(100),self.postMessage({type:"done",payload:W}),e("Posted final payload")}catch(t){const s=t instanceof Error?t.stack||t.message:String(t);e("Caught error in processStats:",s),self.postMessage({type:"error",error:s})}}(n,a).catch(t=>{const s=t instanceof Error?t.stack||t.message:String(t);e("Error inside processStats:",s),self.postMessage({type:"error",error:s})})}})})();